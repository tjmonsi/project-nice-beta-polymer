<link rel="import" href="main-app-behavior.html">
<script>
  (function(){
    'use strict';

    Polymer.ArticleBehaviorImpl = {

      properties: {
        articlePath: {
          type: Object,
          readOnly: true,
          reflectToAttribute: true,
          value: function() { return this._articlePath }
        },

        articleGroup: {
          type: String,
          readOnly: true,
          reflectToAttribute: true,
          value: function() { return this._articleGroup }
        }
      },

      get _articleGroup() {
        return 'article_group';
      },

      get _articlePath() {
        var options = `${this._articleGroup}/options`;
        return {
          articles: `${this._articleGroup}/articles`,
          owners: `${this._articleGroup}/owners`,
          options: {
            published: `${options}/published`,
            draft: `${options}/published`,
            front: `${options}/front`
          }
        };
      },

      _gotoArticle(pageId = '', action, name = 'New Window') {
        this._gotoPage('article-page', pageId, action, name);
      },

      _insertNewArticle(sluggedTitle, e) {
        if (
          sluggedTitle &&
          typeof sluggedTitle === 'string' &&
          sluggedTitle.trim().length >= 0 &&
          this.isEditable &&
          this.$$('#create-new-title').value &&
          this.$$('#create-new-title').value.trim().length >= 0
        ) {
          this.$$('#data-ref').save(`${this.articlePath.articles}/${sluggedTitle}`).then(function(){
            this.$$('#data-ref').data = {
              title: this.$$('#create-new-title').value,
              date_created: this._todayUTCString
            };
            this._setOwner(this.articlePath.owners, sluggedTitle).then(function() {
              this.$.toaster.show('Creating a new Article');
              this.$$('#create-new-fab').removeAttribute('disabled');
              this.$$('#create-new-title').value = '';
              this._gotoArticle(sluggedTitle, 'edit', `New Article: ${this.$$('#create-new-title').value}`);
            }.bind(this)).catch(this._catchError.bind(this));
          }.bind(this)).catch(this._catchError.bind(this));
        }
      }
    };
    Polymer.ArticleBehavior = [
      Polymer.MainAppBehavior,
      Polymer.ArticleBehaviorImpl
    ];
  })();
</script>